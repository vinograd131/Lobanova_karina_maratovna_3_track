
from config import MISTRAL_CLIENT


class ObserverAgent:
    def analyze(self, user_response, position, question):
        """Анализ ответа кандидата с определением сложности следующего вопроса"""

        prompt = f"""Ты - Observer на IT собеседовании для позиции {position}.

ВОПРОС ИНТЕРВЬЮЕРА: "{question}"
ОТВЕТ КАНДИДАТА: "{user_response}"

Проанализируй ответ и дай направление интервьюеру:

1. Оцени качество ответа по шкале 1-10
2. Определи, нужно ли повысить или понизить сложность следующего вопроса
3. Дай конкретную рекомендацию по теме следующего вопроса

Примеры правильных рекомендаций:
- "Ответ отличный (9/10). Кандидат показал глубокое понимание с примерами. Задай более сложный вопрос о микросервисной архитектуре."
- "Ответ хороший (7/10). Кандидат знает основы, но без деталей. Задай вопрос средней сложности о REST API."
- "Ответ слабый (4/10). Кандидат неуверен в теме. Задай более простой вопрос о базовых концепциях."
- "Ответ не по теме. Вежливо верни к теме {position}."

Твой анализ (2 предложения):"""

        response = MISTRAL_CLIENT.chat.complete(
            model="mistral-large-latest",
            messages=[
                {"role": "system", "content": "Ты аналитик собеседований. Оценивай ответы и давай конкретные рекомендации по сложности."},
                {"role": "user", "content": prompt}
            ]
        )

        return response.choices[0].message.content.strip()